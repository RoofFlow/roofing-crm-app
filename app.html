<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Roof Flow CRM â€“ Dashboard</title>
  <link rel="stylesheet" href="style.css">
  <script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <!-- PDFLib for generating PDFs -->
  <script defer src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <script defer src="config.js"></script>
  <script defer src="supa.js"></script>
  <script defer src="app.js"></script>
  <link rel="manifest" href="manifest.json">
</head>
<body>
  <header class="header">
    <h1>Roof Flow CRM</h1>
    <button id="sign-out">Sign Out</button>
  </header>
  <div class="container">
    <div class="toolbar">
      <h2>Add New Lead</h2>
      <button id="export-csv">Export CSV</button>
    </div>
    <form id="lead-form" class="card">
      <input type="text" id="lead-name" placeholder="Homeowner Name">
      <input type="text" id="lead-phone" placeholder="Phone">
      <input type="text" id="lead-email" placeholder="Email">
      <input type="text" id="lead-address" placeholder="Address">
      <button type="submit">Add Lead</button>
    </form>
    <div class="board" id="pipeline-board">
      <!-- Columns populated by app.js -->
    </div>
  </div>

  <!-- Modal for editing lead details -->
  <div class="modal" id="lead-modal">
    <div class="panel">
      <h2>Edit Lead</h2>
      <form id="edit-lead-form">
        <input type="hidden" id="edit-id">
        <label>Name
          <input type="text" id="edit-name" required>
        </label>
        <label>Phone
          <input type="text" id="edit-phone" required>
        </label>
        <label>Email
          <input type="email" id="edit-email">
        </label>
        <label>Address
          <input type="text" id="edit-address">
        </label>
        <h3>Property Info</h3>
        <label>Roof Type
          <input type="text" id="edit-roofType">
        </label>
        <label>Roof Pitch
          <input type="text" id="edit-roofPitch">
        </label>
        <label>Squares
          <input type="number" id="edit-squares" step="0.1" min="0">
        </label>
        <h3>Claim Info</h3>
        <label>Claim Number
          <input type="text" id="edit-claimNumber">
        </label>
        <label>Carrier
          <input type="text" id="edit-carrier">
        </label>
        <label>Deductible
          <input type="number" id="edit-deductible" step="0.01" min="0">
        </label>
        <label>RCV
          <input type="number" id="edit-rcv" step="0.01" min="0">
        </label>
        <label>ACV
          <input type="number" id="edit-acv" step="0.01" min="0">
        </label>
        <label>Depreciation
          <input type="number" id="edit-depreciation" step="0.01" min="0">
        </label>
        <label>Supplement Total
          <input type="number" id="edit-supplement" step="0.01" min="0">
        </label>

        <!-- New section: Claim and Payment Status -->
        <h3>Status</h3>
        <label>Claim Status
          <select id="edit-claimStatus">
            <option value="Not Filed">Not Filed</option>
            <option value="Filed">Filed</option>
            <option value="Approved">Approved</option>
            <option value="Supplements Filed">Supplements Filed</option>
            <option value="Paid">Paid</option>
          </select>
        </label>
        <label>Payment Status
          <select id="edit-paymentStatus">
            <option value="Unpaid">Unpaid</option>
            <option value="Partially Paid">Partially Paid</option>
            <option value="Paid">Paid</option>
          </select>
        </label>

        <!-- New section: File uploads and reports -->
        <h3>Files & Reports</h3>
        <label>Upload Photos
          <input type="file" id="photo-upload" accept="image/*" multiple>
        </label>
        <ul id="photo-list"></ul>
        <button type="button" id="generate-photo-report">Generate Photo Report</button>

        <!-- New section: Contract generation -->
        <h3>Documents</h3>
        <button type="button" id="generate-contract">Generate Contract</button>
        <a id="download-contract-link" href="#" target="_blank" style="display:none">View Contract</a>

        <!-- New section: Crew assignment -->
        <h3>Crew Assignment</h3>
        <label>Crew Name
          <input type="text" id="crew-name">
        </label>
        <label>Scheduled Date
          <input type="date" id="crew-date">
        </label>
        <label>Notes
          <input type="text" id="crew-notes">
        </label>
        <button type="button" id="assign-crew">Assign Crew</button>
        <ul id="crew-list"></ul>
        <div class="modal-actions">
          <button type="button" id="save-lead">Save</button>
          <button type="button" id="advance-lead">Next Stage</button>
          <button type="button" id="delete-lead">Delete</button>
          <button type="button" id="cancel-lead">Close</button>
        </div>
      </form>
    </div>
  </div>
</body>
</html>
